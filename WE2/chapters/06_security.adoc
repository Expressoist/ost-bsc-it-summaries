== Security
=== OWASP Top 10
*A01*: Broken Access Control
*A02*: Cryptographic Failures
*A03*: Injection
*A04*: Insecure Design
*A05*: Security Misconfiguration
*A06*: Vulnerable & Outdated Components
*A07*: Identification & Authentication Failures
*A08*: Software & Data Integrity Failures
*A09*: Security Logging & Monitoring Failures
*A10*: Server-Side Request Forgery

=== Fokusthemen
==== *A01.1*: Insecure Direct Object References (IDOR)
*Beschreibung*: Eine Webseite ist verwundbar, wenn Daten ohne Sicherheitsmechanismen über direkte Referenzen erreichbar sind.
*Beispiel*:
Die Daten eines Nutzers lassen sich über `my-site.ch/:userID` einsehen.
Die Berechtigungen des Aufrufers werden aber nicht geprüft.
Ein Angreifer kann nun z.B. solange IDs ausprobieren, bis er auf die Seite eines Nutzers kommt.

*Lösung*: Alle Seiten mit korrekter Berechtigungskontrolle ausstatten. Bei Express.js z.B. via Middlewares, welche die `req.params.id` mit der aktuellen Nutzer-ID vergleichen.

==== *A01.2*: Cross-Site Request Forgery (CSRF)
*Beschreibung*: Eine Webseite ist verwundbar, wenn sie Formulare zusammen mit Cookies verwendet und die Herkunft des Formulars nicht überprüft.
*Beispiel*: Ein Angreifer bringt einen eingeloggten User dazu, auf `evil.ch` zu gehen. Auf dieser Seite wird (automatisch) ein Formular an `my-site.ch/deleteAccount` gesendet. Da der Browser die Cookies der realen Webseiten mitsendet, wird die Aktion im Namen des Nutzers ausgeführt.

*Lösung*: Formulare mit einem CSRF-Token versehen und beim Request überprüfen. Bei Express.js z.B. das `csurf` Plugin verwenden. Alternativ keine oder SameSite-Cookies verwenden.

==== *A01.3*: Replay Attacks
*Beschreibung*: Eine Webseite ist verwundbar, wenn Aktionen unbeabsichtigt mehrmals ausgeführt werden können.
*Beispiel*: Eine Webseite belohnt die Nutzer für jede korrekte Aufgabe mit Punkten. Ein Nutzer kann nun z.B. eine einzige Aufgabe mehrmals absenden, um so mehrere Punkte zu erhalten.

*Lösung*: Keine "generische" Lösung möglich. In diesem Fall z.B. die Aufgaben abspeichern und nur einmal zählen.

==== *A02*: Cryptographic Failures
*Beschreibung*: Eine Webseite ist verwundbar, wenn sie veraltete oder riskante Kryptoalgorithmen, mangelte Zufallszahlen, hart-kodierte Passwörter oder ähnliches verwendet.
*Beispiel*: Eine Webseite sendet die Logindaten eines Benutzers unverschlüsselt und ohne HTTPs an den Server. Ein Angreifer kann nun z.B. mit einer Network Sniffing Software die Logindaten abhören.

*Lösung*: Verwendung von HTTPs. Keine sensitiven Informationen in der URL codieren. Externe Auth-Services nutzen.

==== *A03.1*: Cross Site Scripting (XSS)
*Beschreibung*: Eine Webseite ist verwundbar, wenn ein Angreifer seinen Schadcode so auf der Seite abspeichern kann, dass dieser im Browser eines Nutzers ausgeführt wird.
*Beispiel*: Die Eingaben eines Formulars werden ohne "Escaping" an andere Nutzer ausgeliefert. Ein Angreifer kann nun z.B. `+<img src='x' onerror='...'>+` eingeben und so beliebigen Code ausführen.

*Lösung*: Escaping/Encoding verwenden. Eingabebereinigung (Sanitizing) via Libraries [.smaller]#(XSS, DOMPurify)# einbauen. CSP-Header setzen. HTTPOnly-Cookies setzen.

footnote:[Für Encoding in HBS `+{{content}}+` anstatt `+{{{content}}}+` verwenden.]

==== *A03.2* Remote Code Execution / Injection
*Beschreibung*: Ein Server ist verwundbar, wenn ein Angreifer den Server dazu bringen kann, seinen Schadcode [.smaller]#(JavaScript, SQL, etc.)# auszuführen.
*Beispiel*: Die Eingaben in einem Formular werden mittels `eval(…)` vom Server in ein bestimmtes Format konvertiert. Ein Angreifer kann nun z.B. `while(true)`, `process.exit()` (DoS) oder `res.end(fs.readdirSync(…).toString())` ausführen.

*Lösung*: Niemals `eval(…)`, sondern `parseInt(…)` oder `JSON.parse(…)` verwenden. Eingabebereinigung einbauen. Rechenintensive Tasks auslagern (gegen DDoS-Attacken). Node.js keine Root-Rechte geben. Globale Scopes und Variablen reduzieren.

footnote:[`setTimeout(…)` und `setInterval(…)` verhalten sich ähnlich wie `eval(…)`.]

==== *A07*: Identification & Authentication Failure
*Beschreibung*: Eine Webseite ist verwundbar, wenn sie u.a. Brute-Force-Attacken erlaubt, schlechte Passwörter zulässt oder keine Multi-Faktor-Authentisierung verwendet.
*Beispiel*: Ein Angreifer bekommt Zugriff auf ein Nutzerkonto, indem er alle möglichen Passwortkombinationen durchprobiert. Da das Passwort "1234" war, ging die Attacke nur wenige Minuten.

*Lösung*: Korrekte Authentisierung einbauen. Auth-Service nutzen.

=== Login & Password Handling
Grundsätzlich sollte man, wenn immer möglich, einen externen Auth-Service (z.B. via OAuth) verwenden. Eine Middleware stellt dabei sicher, dass Anfragen auf geschützte Bereiche nur durch autorisierte Benutzer erlaubt sind (z.B. via Token-Validierung).

footnote:[Bei grossen Firmen mit eignen CySec-Teams sind eigene Auth-Services in Ordnung.]
footnote:[Möglichkeiten: OpenID Connect, OAuth, Passwordless (Magic-Links, WebAuthN, TOTP).]

=== Weiteres
*CSP-Header*: Mechanismus, um das Laden von Ressourcen auf die angegebenen Domains zu beschränken (`Content-Security-Policy: default-src self trusted-service.com`).
*HTTPOnly-*/*SameSite-Cookie*: Blockiert den Zugriff von Client-Scripts sowie von anderen Webseiten.
*Secure-Cookie*: Begrenzt Cookies auf HTTPs.